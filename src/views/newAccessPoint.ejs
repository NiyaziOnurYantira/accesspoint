<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Yeni Access Point - <%= newId %></title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      h1 {
        margin-bottom: 10px;
      }

      table {
        margin-top: 20px;
        border-collapse: collapse;
        min-width: 500px;
      }

      th, td {
        border: 1px solid #ddd;
        padding: 8px;
      }

      th {
        background-color: #f2f2f2;
        text-align: left;
      }

      input[type="text"] {
        width: 100%;
        box-sizing: border-box;
        padding: 6px;
      }

      .btn {
        padding: 8px 14px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        margin-right: 8px;
      }

      .btn-primary {
        background-color: #28a745;
        color: white;
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      #message {
        margin-top: 10px;
      }

      a {
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <h1>Yeni Access Point Ekle</h1>
    <p>Bu sayfada yeni bir Access Point oluşturacaksınız.</p>

    <table>
      <tbody>
        <tr>
          <th>ID</th>
          <td><input type="text" id="id" value="<%= newId %>" readonly /></td>
        </tr>
        <tr>
          <th>MAC</th>
          <td><input type="text" id="mac" /></td>
        </tr>
        <tr>
          <th>Seri Numarası</th>
          <td><input type="text" id="serialNumber" /></td>
        </tr>
        <tr>
          <th>Arıza Durumunda Aranacak Numara</th>
          <td><input type="tel" id="emergencyPhone" placeholder="+90 XXX XXX XX XX" /></td>
        </tr>
        <tr>
          <th>Model</th>
          <td><input type="text" id="model" /></td>
        </tr>
        <tr>
          <th>Lokasyon</th>
          <td><input type="text" id="location" /></td>
        </tr>
        <tr>
          <th>Durum</th>
          <td>
            <input type="text" id="status" placeholder="active / inactive / faulty / maintenance" value="active" />
          </td>
        </tr>
      </tbody>
    </table>

    <h3 style="margin-top: 30px; color: #dc3545;">Admin Doğrulaması</h3>
    <table style="margin-top: 10px;">
      <tbody>
        <tr>
          <th>Admin Kullanıcı Adı</th>
          <td><input type="text" id="adminUsername" placeholder="Admin kullanıcı adınız" /></td>
        </tr>
        <tr>
          <th>Admin Şifre</th>
          <td><input type="password" id="adminPassword" placeholder="Admin şifreniz" /></td>
        </tr>
      </tbody>
    </table>

    <div style="margin-top: 10px;">
      <button class="btn btn-primary" id="btnSave">Kaydet</button>
      <button class="btn btn-secondary" id="btnGotoDetail" disabled>Detay Sayfasına Git</button>
    </div>

    <div id="message"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var inputId = document.getElementById("id");
        var inputMac = document.getElementById("mac");
        var inputSerial = document.getElementById("serialNumber");
        var inputEmergencyPhone = document.getElementById("emergencyPhone");
        var inputModel = document.getElementById("model");
        var inputLocation = document.getElementById("location");
        var inputStatus = document.getElementById("status");
        var inputAdminUsername = document.getElementById("adminUsername");
        var inputAdminPassword = document.getElementById("adminPassword");
        var messageDiv = document.getElementById("message");
        var btnGotoDetail = document.getElementById("btnGotoDetail");

        document.getElementById("btnSave").addEventListener("click", function () {
          messageDiv.textContent = "";

          var payload = {
            id: inputId.value,
            mac: inputMac.value,
            serialNumber: inputSerial.value,
            emergencyPhone: inputEmergencyPhone.value,
            model: inputModel.value,
            location: inputLocation.value,
            status: inputStatus.value || "active",
            adminUsername: inputAdminUsername.value,
            adminPassword: inputAdminPassword.value,
          };

          if (!payload.mac || !payload.serialNumber || !payload.emergencyPhone || !payload.model || !payload.location) {
            messageDiv.textContent = "MAC, Seri Numarası, Acil Durum Telefonu, Model, Lokasyon zorunludur.";
            return;
          }

          if (!payload.adminUsername || !payload.adminPassword) {
            messageDiv.textContent = "Admin kullanıcı adı ve şifresi zorunludur.";
            return;
          }

          fetch("/api/admin/access-points", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          })
            .then(function (response) {
              if (!response.ok) {
                return response.json().then(function (data) {
                  throw new Error(data.message || "Access Point oluşturulamadı.");
                }).catch(function () {
                  throw new Error("Access Point oluşturulamadı.");
                });
              }
              return response.json();
            })
            .then(function (data) {
              var ap = data.accessPoint;
              messageDiv.innerHTML = "Access Point başarıyla oluşturuldu. ID: <strong>" + (ap && ap.id) + "</strong>";
              btnGotoDetail.disabled = false;
              btnGotoDetail.addEventListener("click", function () {
                if (ap && ap.id) {
                  window.open("/" + encodeURIComponent(ap.id), "_blank");
                }
              });
            })
            .catch(function (err) {
              console.error(err);
              messageDiv.textContent = err.message || "Bir hata oluştu.";
            });
        });
      });
    </script>
  </body>
</html>
